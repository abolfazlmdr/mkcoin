<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AirDrop Clicker</title>
  <style>
    /* همان استایل‌های شما */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: Arial, sans-serif;
    }

    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
      z-index: 9999;
      user-select: none;
    }

    #loading img {
      width: 150px;
      height: auto;
      margin-bottom: 20px;
    }

    #loadingProgressBar {
      width: 300px;
      height: 20px;
      background: #444;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }

    #loadingProgressBar span {
      display: block;
      height: 100%;
      background: #f2b200;
      width: 0;
      border-radius: 10px;
      transition: width 0.1s ease-out;
    }

    #loadingPercent {
      margin-top: 10px;
      font-size: 18px;
      color: #ffc107;
    }

    #main {
      display: none;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #2b1e17, #f2b200);
      color: white;
      text-align: center;
    }

    .container {
      width: 90%;
      max-width: 400px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      padding-bottom: 100px;
    }

    .coin-count {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .coin-count img {
      width: 40px;
      margin-right: 10px;
    }

    .rank {
      color: gold;
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 20px;
    }

    .profile-pic {
      width: 250px;
      height: 250px;
      object-fit: cover;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.1s;
      -webkit-tap-highlight-color: transparent;
      margin-top: 20px;
    }

    .energy-container {
      margin-top: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .energy-bar {
      font-size: 18px;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 10px;
      min-width: 150px;
    }

    .energy-boost-btn {
      background: #f2b200;
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      font-size: 22px;
      margin-left: 15px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      transition: transform 0.1s, background 0.2s;
    }

    .energy-boost-btn:hover {
      background: #ffca3a;
    }

    .progress-bar {
      width: 100%;
      height: 18px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-bar span {
      display: block;
      height: 100%;
      background: #f2b200;
      border-radius: 10px;
      width: 0;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 16px;
    }

    @keyframes shake {
      0% { transform: translate(0, 0) rotate(0); }
      20% { transform: translate(-5px, 5px) rotate(-2deg); }
      40% { transform: translate(5px, -5px) rotate(2deg); }
      60% { transform: translate(-5px, 5px) rotate(-2deg); }
      80% { transform: translate(5px, -5px) rotate(2deg); }
      100% { transform: translate(0, 0) rotate(0); }
    }

    .shake {
      animation: shake 0.5s;
    }

    /* منوی پایین جدید با گرادیان رنگی و طراحی حرفه‌ای */
    .menu {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      z-index: 999;
      backdrop-filter: blur(5px);
    }

    .menu a {
      text-decoration: none;
      color: black;
      text-align: center;
      font-size: 12px;
      flex: 1;
      padding: 6px;
      border-radius: 15px;
      transition: transform 0.2s ease;
    }

    .menu a:hover {
      transform: scale(1.07);
    }

    .menu-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .menu-icon img {
      width: 36px;
      height: 36px;
      background: rgba(255, 255, 255, 0.1);
      padding: 8px;
      border-radius: 50%;
      margin-bottom: 4px;
    }

    .menu-icon span {
      font-size: 13px;
      font-weight: 900; /* بسیار ضخیم */
      color: black;
    }

    /* رنگ‌های گرادیان خاص برای هر دکمه */
    .task-btn   { background: linear-gradient(135deg, #f7971e, #ffd200); }
    .boost-btn  { background: linear-gradient(135deg, #f7971e, #ffd200); }
    .king-btn   { background: linear-gradient(135deg, #f7971e, #ffd200); }
    .profile-btn{ background: linear-gradient(135deg, #f7971e, #ffd200); }
  </style>
</head>
<body>
  <div id="loading">
    <img src="images/loading.jpg" alt="در حال بارگذاری..." />
    <p>در حال بارگذاری مختار کوین</p>
    <div id="loadingProgressBar"><span></span></div>
    <div id="loadingPercent">۰٪</div>
  </div>

  <div id="main">
    <div class="container">
      <div class="progress-bar"><span id="progressBar"></span></div>
      <div class="progress-info"><span id="currentCoins">0</span> <span id="coinsNeeded">0</span></div>
      <div class="coin-count"><img src="images/mokhtar.png" alt="Coin" /> <span id="coinValue">0</span></div>
      <p class="rank">🏆 <span id="rankTitle">سرباز</span></p>
      <div style="margin: 20px 0; font-size: 20px;">⚡ قدرت کل: <span id="powerValue">0</span></div>
      <img src="images/mokhtar.png" alt="Profile" id="clickBtn" class="profile-pic" />
      <div class="energy-container">
        <div class="energy-bar">⚡️ <span id="energyValue">1000</span> / <span id="storageValue">1000</span></div>
        <button class="energy-boost-btn" onclick="window.location.href='booster.html'">
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.46968 7.46967C4.61033 7.32902 4.8011 7.25 5.00001 7.25H9.85509L11.6439 5.46121C12.2145 4.89058 12.6514 4.45363 13.0356 4.09635L15.9386 6.99965L14.4687 8.46959L15.5293 9.53025L16.9992 8.06037L19.9024 10.9639C19.5451 11.348 19.1083 11.7848 18.5379 12.3552L16.75 14.1431V19C16.75 19.1989 16.671 19.3897 16.5303 19.5303L13.5303 22.5303C13.3544 22.7063 13.1026 22.7835 12.8582 22.7365C12.6138 22.6894 12.4087 22.5242 12.3106 22.2954L11.0055 19.2498H8.50001C8.30104 19.2498 8.11021 19.1708 7.96955 19.03L4.97102 16.03C4.83044 15.8894 4.75148 15.6987 4.75148 15.4998V12.9945L1.70471 11.6894C1.47592 11.5914 1.31065 11.3863 1.26356 11.1419C1.21647 10.8975 1.29369 10.6457 1.46968 10.4697L4.46968 7.46967Z" fill="#fff"/>
    <path d="M20.8551 9.79524L14.2043 3.14369C15.5241 2.2299 17.0345 1.62564 18.6229 1.37756C19.44 1.24995 20.4021 1.24997 21.9225 1.25H21.9991C22.4133 1.25 22.7491 1.58579 22.7491 2V2.07658C22.7491 3.597 22.7491 4.5591 22.6215 5.3762C22.3734 6.96472 21.7691 8.47528 20.8551 9.79524Z" fill="#fff"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M1.62695 12.9606L3.29281 11.293L4.70776 12.7064L3.0419 14.374L1.62695 12.9606ZM9.62695 20.9606L11.2928 19.293L12.7078 20.7064L11.0419 22.374L9.62695 20.9606Z" fill="#fff"/>
  </svg>
</button>

      </div>
    </div>

    <!-- منوی پایین -->
    <div class="menu">
      <a href="task.html" class="menu-icon task-btn">
        <img src="images/task.webp" alt="خزانه">
        <span>افزایش خزانه</span>
      </a>
      <a href="boost.html" class="menu-icon boost-btn">
        <img src="images/booster.webp" alt="قدرت">
        <span>افزایش قدرت</span>
      </a>
      <a href="king.html" class="menu-icon king-btn">
        <img src="images/king.webp" alt="پادشاهی">
        <span>پادشاهی</span>
      </a>
      <a href="friends.html" class="menu-icon profile-btn">
        <img src="images/profile.webp" alt="پروفایل">
        <span>پروفایل</span>
      </a>
    </div>
  </div>

  <script>
    const hasLoadedBefore = sessionStorage.getItem("loaded");
    if (!hasLoadedBefore) {
      let progress = 0;
      const loadingBar = document.querySelector("#loadingProgressBar span");
      const loadingInterval = setInterval(() => {
        progress += 2;
        if (progress > 100) progress = 100;
        loadingBar.style.width = progress + "%";
        document.getElementById("loadingPercent").innerText = progress + "٪";
        if (progress >= 100) {
          clearInterval(loadingInterval);
          document.getElementById("loading").style.display = "none";
          document.getElementById("main").style.display = "flex";
          sessionStorage.setItem("loaded", "true");
          initializeGame();
        }
      }, 60);
    } else {
      document.getElementById("loading").style.display = "none";
      document.getElementById("main").style.display = "flex";
      initializeGame();
    }

    function initializeGame() {
      let coinValue = parseInt(localStorage.getItem("coins")) || 0;
      let energyValue = parseInt(localStorage.getItem("energy")) || 1000;
      let storage = parseInt(localStorage.getItem("storage")) || 1000;
      let multitapPower = parseInt(localStorage.getItem("multitapPower")) || 1;
      let lastActive = parseInt(localStorage.getItem("lastActive")) || Date.now();
      let now = Date.now();
      let diffSeconds = Math.floor((now - lastActive) / 1000);
      let earnedEnergy = Math.floor(diffSeconds / 1) * 1;
      energyValue = Math.min(storage, energyValue + earnedEnergy);
      localStorage.setItem("energy", energyValue);
      localStorage.setItem("lastActive", now);

      function formatNumber(number) {
        return number.toLocaleString('en-US');
      }

      document.getElementById("coinValue").innerText = formatNumber(coinValue);
      document.getElementById("energyValue").innerText = formatNumber(energyValue);
      document.getElementById("storageValue").innerText = formatNumber(storage);

      function updateRank() {
        const rankThresholds = [
          { threshold: 5000, rank: "سرباز" },
          { threshold: 15000, rank: "سرباز با تجربه" },
          { threshold: 50000, rank: "فرمانده" },
          { threshold: 100000, rank: "فرمانده با تجربه" },
          { threshold: 500000, rank: "فرمانده سوم" },
          { threshold: 1000000, rank: "فرمانده دوم" },
          { threshold: 5000000, rank: "فرمانده اول" },
          { threshold: 10000000, rank: "رهبر" },
          { threshold: 50000000, rank: "پادشاهی" }
        ];
        const rank = rankThresholds.reverse().find(item => coinValue >= item.threshold)?.rank || "سرباز";
        document.getElementById("rankTitle").innerText = rank;
      }

      function updateProgressBar() {
        const nextRankThreshold = [15000, 50000, 100000, 500000, 1000000, 5000000, 10000000, 50000000];
        const nextRank = nextRankThreshold.find(t => coinValue < t) || 50000000;
        const progress = Math.min(100, (coinValue / nextRank) * 100);
        document.getElementById("progressBar").style.width = progress + '%';
        document.getElementById("coinsNeeded").innerText = formatNumber(nextRank);
        document.getElementById("currentCoins").innerText = formatNumber(coinValue);
      }

      function autoIncreaseEnergy() {
        if (energyValue < storage) {
          energyValue += 1;
          document.getElementById("energyValue").innerText = formatNumber(energyValue);
          localStorage.setItem("energy", energyValue);
        }
      }

      function updatePower() {
        let totalPower = parseInt(localStorage.getItem("totalPower")) || 0;
        document.getElementById("powerValue").innerText = totalPower.toLocaleString();
      }

      // اضافه شده: چک حمله دشمن و کاهش سکه در صورت نیاز
      function attackIfNeeded() {
        let coins = parseInt(localStorage.getItem("coins")) || 50000;
        const lastAttackTime = parseInt(localStorage.getItem("lastAttackTime")) || 0;
        const now = Date.now();
        const twelveHours = 12 * 60 * 60 * 1000;
        const timePassed = now - lastAttackTime;

        if (lastAttackTime === 0 || timePassed >= twelveHours) {
          const resources = ["انبار گندم", "دیوار دفاعی", "سربازخانه", "برج دیده‌بانی"];
          const attackedResource = resources[Math.floor(Math.random() * resources.length)];
          const damage = Math.floor(Math.random() * (3000 - 1500 + 1)) + 1500;

          coins = Math.max(0, coins - damage);
          localStorage.setItem("coins", coins);
          localStorage.setItem("lastAttackTime", now);

          alert(`❗️ دشمن به ${attackedResource} حمله کرد و ${damage.toLocaleString()} سکه از شما کم شد.`);
          document.getElementById("coinValue").innerText = formatNumber(coins);
        }
      }

      document.getElementById("clickBtn").addEventListener("click", function () {
        if (energyValue >= multitapPower) {
          coinValue += multitapPower;
          energyValue -= multitapPower;
          document.getElementById("coinValue").innerText = formatNumber(coinValue);
          document.getElementById("energyValue").innerText = formatNumber(energyValue);
          localStorage.setItem("coins", coinValue);
          localStorage.setItem("energy", energyValue);
          updateRank();
          updateProgressBar();
          if (navigator.vibrate) navigator.vibrate(50);
          this.classList.add("shake");
          setTimeout(() => this.classList.remove("shake"), 500);
        }
      });

      setInterval(autoIncreaseEnergy, 2000);
      setInterval(updatePower, 2000);

      window.addEventListener("beforeunload", () => {
        localStorage.setItem("lastActive", Date.now());
      });

      updateRank();
      updateProgressBar();
      updatePower();

      // فراخوانی حمله دشمن در زمان ورود به صفحه
      attackIfNeeded();
    }

    window.addEventListener('message', (event) => {
  if (event.data?.type === 'BOOST_USED') {
    const newEnergy = event.data.energy;
    localStorage.setItem('energy', newEnergy);

    const energyElement = document.getElementById('energyValue');
    if (energyElement) {
      energyElement.innerText = newEnergy.toLocaleString('en-US');
    }
  }
});

// وقتی سکه‌ها در localStorage تغییر کنن (مثلاً از rocket.html)، این اجرا میشه
window.addEventListener("storage", function (event) {
  if (event.key === "coins") {
    const updatedCoins = parseInt(event.newValue || "0");
    document.getElementById("coinValue").innerText = updatedCoins.toLocaleString('en-US');

    // آپدیت درجه و نوار پیشرفت هم انجام بده اگه داری
    updateRank?.();
    updateProgressBar?.();
  }
});

  </script>
</body>
</html>
